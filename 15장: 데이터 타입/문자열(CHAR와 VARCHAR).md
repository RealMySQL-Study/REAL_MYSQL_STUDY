## 저장공간
CHAR와 VARCHAR의 공통점은 문자열을 저장할 수 있는 데이터 타입이라는 점이고, 가장 큰 차이점은 고정 길이냐 가변길이냐이다.  

* 가변 길이는 최대로 저장할 수 있는 값의 길이는 제한돼 있지만, 그 이하 크기의 값이 저장되면 그만큼 저장 공간이 줄어든다.  
VARCHAR 타입은 저장된 값의 유효 크기가 얼마인지를 별도로 저장해 둬야 하므로 1~2 바이트의 저장공간이 추가로 필요하다.  
* 고정 길이는 실제 저장된 값의 유효 크기가 얼마인지 별도로 저장할 필요가 없으므로 추가로 공간이 필요하지 않다.

하나의 글자를 저장하기 위해 CHAR(1), VARCHAR(1) 타입을 사용할 때 실제 사용되는 저장 공간의 크기를 살펴보자.  
두 문자열 타입 모두 한 글자를 저장할 때 사용하는 문자 집합에 따라 실제 저장 공간은 1 ~ 4 바이트까지 사용한다.  
CHAR 타입에 저장될 때는 추가 공간이 더 필요하지 않지만, VARCHAR 타입에 저장할 때는 문자열의 길이를 관리하기 위한 1~2바이트의 공간을 추가로 더 사용한다.  

VARCHAR 타입의 길이가 255바이트 이하이면 1바이트만 사용하고, 256바이트 이상으로 설정되면 2바이트를 사용한다.  
VARCHAR 타입의 최대 길이는 2바이트로 표현할 수 있는 이상은 사용할 수 없기 때문에 최대 길이는 65,536바이트 이상으로 설정할 수 없다.  

```
주의!

mysql에서는 하나의 레코드에서 TEXT와 BLOB 타입을 제외한 칼럼의 전체 크기가 64KB를 초과할 수 없다.

다른 컬럼에서 40KB의 크기를 사용하고 있다면 VARCHAR타입은 24KB만 사용할 수 있다.
이 때 24KB를 초과하는 크기의 VARCHAR타입을 생성하려고하면, 에러가 발생하거나 자동으로 TEXT타입으로 대체된다.  
```

문자열 값의 길이가 항상 일정하면 CHAR를 사용하고, 가변적이라면 VARCHAR를 사용하는 것이 일반적이다.  
VARCHAR타입을 선택해도 디스크에서 1바이트만 더 사용할 뿐인데, CHAR와 VARCHAR를 결정할 때 길이가 정적이냐 가변적이냐만으로 결정하는것은 적절하지 않다.  

중요한 기준은 다음과 같다.  
* 저장되는 문자열의 길이가 대개 비슷한다?
* 칼럼의 값이 자주 변경되는가?(중요)

```
CREATE TABLE tb_test (
	fd1 INT NOT NULL,
    fd2 CHAR(10) NOT NULL,
    fd3 DATETIME NOT NULL
);

INSERT INTO tb_test (fd1, fd2, fd3) VALUES (1, 'ABCD', '2011-06-27 11:02:11');
```
![image](https://github.com/RealMySQL-Study/REAL_MYSQL_STUDY/assets/67637716/7a4eac23-f1df-4c58-a93b-f3a363fdaf35)  

fd2 칼럼을 VARCHAR(10)으로 바꾸게 되면 다음과 같을 것이다.  
![image](https://github.com/RealMySQL-Study/REAL_MYSQL_STUDY/assets/67637716/29eb5815-7850-455a-be59-b4d7565da675)  

중요한 것은 레코드 한 건이 저장된 상태가 아니라 fd2 칼럼의 값이 변경될 때 어떤 현상이 발생하느냐다.  
fd2 컬럼의 값을 `ABCDE`로 UPDATE 하게되면 다음과 같다.  

* CHAR(10) 은 공간이 이미 10바이트가 준비되어 있으므로 그냥 값만 업데이트 하면된다.
* VARCHAR(10)을 사용하는 칼럼은 길이가 더 큰 값으로 변경될 때는 레코드 자체를 다른 공간으로 옮겨서 저장해야한다.


<br>  
CHAR나 VARCHAR 키워드 뒤에 인자로 전달하는 숫자는 MYSQL에서는 칼람의 바이트 크기가 아니라 문자의 수를 의미한다.  
그래서 CHAR(10) 타입을 사용하더라도 이 칼럼이 실제로 디스크나 메모리에서 사용하는 공간은 각각 달라진다.  

* 영어를 포함한 서구권 언어는 각 문자가 1바이트를 사용하므로 10바이트를 사용한다.
* 한국어나 일본어와 같은 아시아권 언어는 각 문자가 최대 2바이트를 사용하므로 20바이트를 사용한다.
* UTF-8과 같은 유니코드는 최대 4바이트까지 사용하므로 40바이트까지 사용할 수 있다.

## 저장 공간과 스키마 변경(Online DDL)
VARCHAR 타입을 사용하는 칼럼의 길이를 늘리는 작업은 길이에 따라 매우 빠르게 처리될 수도 있지만 어떤 경우에는 테이블에 대해 읽기 잠금을 걸고 레코드를 복사하는 작업이 필요할 수도있다.  

```
CREATE TABLE test (
 id INT PRIMARY KEY,
 value VARCHAR(60)
) DEFAULT CHARSET=utf8mb4
```  

value 칼람의 길이를 63으로 늘리는 경우과 64로 늘리는 경우 Online DDL 명령의 결과는 다음과 같다.  
![image](https://github.com/RealMySQL-Study/REAL_MYSQL_STUDY/assets/67637716/b541e882-7f9d-41ed-a777-604ffd6624aa)  

63으로 늘리는 경우는 잠금 없이 매우 빠르게 변경되었지만 64로 늘리는 경우는 COPY 알고리즘으로 스키마 변경을 실행해야되며 읽기잠금까지 필요로 하게 된다.  
이런 차이가 발생하는 이유는 utf 문자 집합을 사용하는 VARCHAR(60)은 최대 240바이트를 사용하기 때문에 문자열 값의 길이를 저장하는 공간은 1바이트면 된다.  
그러나 VARCHAR(64) 타입은 최대 저장할 수 있는 문자열의 크기가 256바이트까지 가능하므로 문자열 길이를 저장하는 공간의 크기가 2바이트로 바뀌어야 하고,  
이렇게 문자열길이를 저장하는 공간의 크기가 바뀌게 되면, 스키마 변경을 하는 동안 읽기 잠금을 걸고, 테이블의 레코드를 복사하는 방식으로 처리한다.  

## 문자 집합(캐릭터 셋)


